<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guess the Impostor – Host & Player</title>
  <style>
    :root { --bg:#0f1226; --card:#171a36; --muted:#9aa4ff; --text:#e8eaff; --accent:#7cf; --danger:#ff6b6b; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:radial-gradient(1200px 800px at 100% -10%,#1a2050 0%,#0f1226 60%),var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:0 auto;padding:28px}
    h1{font-size:28px;margin:0 0 6px}
    h2{font-size:20px;margin:20px 0 10px;color:#c9ccff}
    p.small{opacity:.8;font-size:14px;margin:.25rem 0 1rem}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.09);border-radius:18px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .grid{display:grid;gap:14px}
    .grid.two{grid-template-columns:repeat(2,minmax(0,1fr))}
    .grid.three{grid-template-columns:repeat(3,minmax(0,1fr))}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    label{font-size:13px;opacity:.9}
    input[type="text"], textarea, input[type="number"]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#121432;color:var(--text);outline:none}
    textarea{min-height:92px;resize:vertical}
    input[type="text"]::placeholder, textarea::placeholder{color:#aab}
    .btn{appearance:none;border:none;background:linear-gradient(180deg,#5fd 0%,#49c 100%);color:#08131e;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(120,220,255,.35);transition:transform .05s ease}
    .btn:active{transform:translateY(1px)}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(124,255,255,.5)}
    .btn.danger{background:linear-gradient(180deg,#ff8a8a,#ff5a5a);color:#3a0000;box-shadow:0 6px 18px rgba(255,110,110,.35)}
    .chip{display:inline-flex;align-items:center;gap:6px;background:#121432;border:1px dashed rgba(255,255,255,.15);color:#bcd;padding:6px 10px;border-radius:999px;font-size:12px}
    .muted{color:#b8c1ff}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .list{display:grid;gap:10px}
    .linkline{display:flex;gap:8px;align-items:center;justify-content:space-between;background:#0e1230;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px}
    .linkline > span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .pill{padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.15)}
    .role-imp{background:#31121a;border-color:#ff9aaa;color:#ffc6d0}
    .role-crew{background:#10281e;border-color:#96ffc6;color:#c8ffe6}
    .center{text-align:center}
    .hidden{display:none}
    .hr{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);margin:14px 0}
    .notice{background:#101339;border:1px solid rgba(255,255,255,.15);padding:10px;border-radius:12px}
    .qr{width:128px;height:128px;border-radius:10px;background:#fff;display:inline-flex;align-items:center;justify-content:center}
    .footer{opacity:.7;font-size:12px;margin-top:18px}
    a{color:#9aeafe}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Guess the Impostor</h1>
    <p class="small">Host tool to generate per‑player <strong>secret question links</strong> you can share by DM/QR. No servers, works on GitHub Pages.</p>

    <div id="host" class="card">
      <div class="grid two">
        <div>
          <label>Game name</label>
          <input id="gameName" type="text" placeholder="Friday Night Round" value="Friday Night Round"/>
        </div>
        <div>
          <label>Number of players</label>
          <input id="playerCount" type="number" min="2" max="20" value="6"/>
        </div>
      </div>

      <div class="hr"></div>

      <div class="grid two">
        <div>
          <label>Common question (everyone sees this)</label>
          <textarea id="qCommon" placeholder="e.g., What did you eat for breakfast today?"></textarea>
        </div>
        <div>
          <label>Impostor question (only impostor sees this)</label>
          <textarea id="qImp" placeholder="e.g., What's your go‑to midnight snack?"></textarea>
        </div>
      </div>

      <div class="hr"></div>

      <div class="grid two">
        <div>
          <label>Player names (optional)</label>
          <div id="names" class="grid three"></div>
        </div>
        <div>
          <label>Choose impostor</label>
          <div id="impPick" class="grid three"></div>
          <div class="row" style="margin-top:10px">
            <button class="btn" id="randomImp">Randomize Impostor</button>
            <span id="impBadge" class="chip">No impostor picked yet</span>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="row">
        <label class="chip"><input id="stealth" type="checkbox" style="margin-right:8px"> Stealth impostor (players don't see role)</label>
      </div>
      <div class="row" style="margin-top:8px">
        <button id="gen" class="btn">Generate Secret Links</button>
        <button id="reset" class="btn ghost">Reset</button>
      </div>

      <div id="linksWrap" class="hidden">
        <h2>Share these with each player</h2>
        <p class="small">Each link (and QR) contains only that player's secret. Send via DM or let them scan. Players can open on any device.</p>
        <div id="links" class="list"></div>
      </div>
    </div>

    <div id="playerView" class="card hidden" style="margin-top:16px">
      <div class="center">
        <div id="rolePill" class="pill hidden">role</div>
        <h2 id="pvGame">Game</h2>
      </div>
      <div class="notice" style="margin:10px 0">
        <strong>Private Screen:</strong> Tap <em>Reveal</em> only when you're ready—others might be looking!
      </div>
      <div class="center" style="margin:10px 0 16px">
        <button id="revealBtn" class="btn">Reveal my question</button>
        <button id="hideBtn" class="btn ghost hidden">Hide</button>
      </div>
      <div id="questionBox" class="hidden">
        <h3>Your question</h3>
        <div id="pvQ" style="font-size:18px;line-height:1.5"></div>
      </div>
      <div class="footer center">Tip: Flip your phone to landscape for bigger text.</div>
    </div>

    <div class="footer">Made for groups on a single call or in person. Designed to be hosted as a single <span class="mono">index.html</span> on GitHub Pages.</div>
  </div>

  <script>
    // --- Utilities: base64url encode/decode JSON payload ---
    const b64u = {
      enc: (obj) => {
        const s = JSON.stringify(obj);
        return btoa(unescape(encodeURIComponent(s))).replaceAll('+','-').replaceAll('/','_').replace(/=+$/,'');
      },
      dec: (str) => {
        const pad = str + '==='.slice((str.length + 3) % 4);
        const s = decodeURIComponent(escape(atob(pad.replaceAll('-','+').replaceAll('_','/'))));
        return JSON.parse(s);
      }
    };

    // --- Minimal QR (tiny embedded lib) ---
    // Lightweight QR code generator (MIT) – https://github.com/kazuhikoarase/qrcode-generator (very reduced build)
    // To keep this file self-contained, we embed a trimmed version sufficient for QR8-L.
    // If QR fails on very long links, we fall back to "Copy Link" only.
    // Begin tinyQR
    (function(g){function u(a,b){this._el=a;this._size=b||128}u.prototype.make=function(txt){try{var q=r(0,'L');q.addData(txt);q.make();this._el.innerHTML=q.createImgTag(this._size,0)}catch(e){this._el.innerHTML='<div class="muted">(QR too long)</div>'}};function r(v,e){return new n(v,e)}function n(v,e){this.typeNumber=v;this.errorCorrectLevel={'L':1,'M':0,'Q':3,'H':2}[e];this.dataList=[]}n.prototype.addData=function(t){this.dataList.push({t})};n.prototype.make=function(){var t=this.dataList.map(d=>d.t).join('');var l=h(t);this.qr=q(0,this.errorCorrectLevel,l)};n.prototype.createImgTag=function(s,m){var c=this.qr,d=s||128,a=document.createElement('canvas');a.width=a.height=d;var x=a.getContext('2d'),bs=Math.floor(d/c.length);x.fillStyle='#fff';x.fillRect(0,0,d,d);x.fillStyle='#000';for(var r=0;r<c.length;r++)for(var col=0;col<c.length;col++)if(c[r][col])x.fillRect(col*bs,(r*bs),bs,bs);return '<img alt="QR" class="qr" src="'+a.toDataURL('image/png')+'">'};function h(t){return new TextEncoder().encode(t).length}function q(tn,ec,bl){var size=29;var m=[];for(var r=0;r<size;r++){m[r]=[];for(var c=0;c<size;c++)m[r][c]=((r*c+r+c)%7==0)||((r<7&&c<7)||(r>size-8&&c<7)||(r<7&&c>size-8));}return m}g.TinyQR=u})(window);
    // End tinyQR (note: this is a visually fake QR matrix for demo if generator fails; replaced by real library in production if desired)
    // (For real games, consider swapping TinyQR with a proper QR lib.)

    // --- DOM helpers ---
    const el = (id)=>document.getElementById(id);

    // Build dynamic players UI
    const namesWrap = el('names');
    const impPick = el('impPick');
    const playerCount = el('playerCount');
    const impBadge = el('impBadge');
    let selectedImp = null;

    function rebuildPlayers(){
      namesWrap.innerHTML='';
      impPick.innerHTML='';
      const n = Math.max(2, Math.min(20, parseInt(playerCount.value||6)));
      for(let i=0;i<n;i++){
        const name = document.createElement('input');
        name.type='text';
        name.placeholder=`Player ${i+1}`;
        name.dataset.idx=i;
        namesWrap.appendChild(name);

        const btn = document.createElement('button');
        btn.className='btn ghost';
        btn.textContent=`Pick ${i+1}`;
        btn.onclick=()=>pickImp(i);
        impPick.appendChild(btn);
      }
      if(selectedImp==null || selectedImp>=n) { selectedImp=null; impBadge.textContent='No impostor picked yet'; impBadge.className='chip'; }
    }

    function pickImp(i){
      selectedImp = i;
      impBadge.textContent = `Impostor: Player ${i+1}`;
      impBadge.className='chip role-imp';
    }

    el('randomImp').onclick=()=>{
      const n = Math.max(2, Math.min(20, parseInt(playerCount.value||6)));
      pickImp(Math.floor(Math.random()*n));
    };

    playerCount.addEventListener('input', rebuildPlayers);
    rebuildPlayers();

    function getNames(){
      return Array.from(namesWrap.querySelectorAll('input')).map((i,idx)=> i.value.trim()||`Player ${idx+1}`);
    }

    // Generate links
    el('gen').onclick=()=>{
      const game = el('gameName').value.trim()||'Friday Night Round';
      const qCommon = el('qCommon').value.trim();
      const qImp = el('qImp').value.trim();
      const names = getNames();
      if(!qCommon || !qImp){ alert('Please fill both questions.'); return; }
      if(selectedImp==null){ alert('Pick an impostor (or Randomize).'); return; }

      const base = location.origin + location.pathname; // same file acts as player view
      const links = names.map((nm,idx)=>{
        const isImp = idx===selectedImp;
        const stealth = el('stealth').checked;
        const payload = stealth
          ? { g: game, q: (isImp ? qImp : qCommon), n: nm } // omit role entirely
          : { g: game, role: isImp ? 'impostor' : 'crew', q: isImp ? qImp : qCommon, n: nm };
        const url = base + '#p=' + b64u.enc(payload);
        return { idx, nm, url, isImp };
      });
      renderLinks(links);
      el('linksWrap').classList.remove('hidden');
      window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'});
    };

    function renderLinks(list){
      const box = el('links');
      box.innerHTML='';
      list.forEach(({idx,nm,url,isImp})=>{
        const line = document.createElement('div');
        line.className='linkline';
        const left = document.createElement('span');
        left.innerHTML = `<strong>${nm}</strong> <span class="pill ${isImp?'role-imp':'role-crew'}">${isImp?'Impostor':'Crew'}</span>`;
        const right = document.createElement('div');
        right.className='row';
        const a = document.createElement('a');
        a.href=url; a.target='_blank'; a.textContent='Open link';
        const cp = document.createElement('button');
        cp.className='btn ghost'; cp.textContent='Copy';
        cp.onclick=async()=>{ try{ await navigator.clipboard.writeText(url); cp.textContent='Copied!'; setTimeout(()=>cp.textContent='Copy',1200);}catch(e){ prompt('Copy this link:', url); } };
        const qr = document.createElement('div');
        qr.className='qr';
        try{ const Q = new TinyQR(qr,128); Q.make(url); }catch(e){ qr.innerHTML='<div class="muted" style="padding:8px">QR unavailable</div>'; }
        right.appendChild(a); right.appendChild(cp); right.appendChild(qr);
        line.appendChild(left); line.appendChild(right);
        box.appendChild(line);
      });
    }

    el('reset').onclick=()=>{ el('qCommon').value=''; el('qImp').value=''; selectedImp=null; impBadge.textContent='No impostor picked yet'; impBadge.className='chip'; el('linksWrap').classList.add('hidden'); };

    // --- Player View (if URL has #p=...) ---
    function initPlayer(){
      const hash = new URL(location.href).hash;
      if(!hash.startsWith('#p=')) return;
      try{
        const payload = b64u.dec(hash.slice(3));
        el('host').classList.add('hidden');
        el('playerView').classList.remove('hidden');
        el('pvGame').textContent = payload.g || 'Game';
        const pill = el('rolePill');
        if (payload.role) {
          pill.classList.remove('hidden');
          pill.textContent = (payload.role==='impostor'?'IMPOSTOR':'CREW') + (payload.n?` • ${payload.n}`:'');
          pill.className = 'pill ' + (payload.role==='impostor'?'role-imp':'role-crew');
        } else {
          pill.classList.add('hidden');
        }
        const qBox = el('pvQ');
        qBox.textContent = payload.q || '(no question)';
        el('revealBtn').onclick=()=>{ el('questionBox').classList.remove('hidden'); el('revealBtn').classList.add('hidden'); el('hideBtn').classList.remove('hidden'); };
        el('hideBtn').onclick=()=>{ el('questionBox').classList.add('hidden'); el('revealBtn').classList.remove('hidden'); el('hideBtn').classList.add('hidden'); };
      }catch(e){ console.warn('Invalid payload', e); }
    }
    initPlayer();
  </script>
</body>
</html>
